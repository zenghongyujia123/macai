<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1,user-scalable=no,width=device-width" />
  <meta name="x5-fullscreen" content="true">
  <meta name="full-screen" content="yes">
  <title>采购列表</title>
  <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
  <link rel="stylesheet" href="../c_libs/minirefresh.min.css" />
  <link rel="stylesheet" href="../c_libs/common.css" />
  <link rel="stylesheet" href="../libs/Swiper/dist/css/swiper.min.css" />

  <link rel="stylesheet" href="../c_wechat/css/page_index.client.style.css" />

  <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.0/css/jquery-weui.min.css">
  <script type="text/javascript" src="../libs/Swiper/dist/js/swiper.min.js"></script>
  <script src="../c_libs/minirefresh.min.js"></script>
  <script src="../libs/jquery/dist/jquery.js"></script>

  <script src="https://cdn.bootcss.com/jquery-weui/1.2.0/js/jquery-weui.min.js"></script>
  <script src="../c_wechat/controllers/page_signin.client.controller.js"></script>
  <meta name="baidu-site-verification" content="4hPH3hudxx" />


  <script src="../c_libs/common.js"></script>
  <style>
    .swiper-container {
      position: absolute;
      top: 50px;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .minirefresh-wrap {
      top: 0;
    }
  </style>
</head>

<body>
  <div class="weui-tab">
    <div class="weui-tab__bd">
      <div class="content">
        <div class="nav-control">
          <p class="active" list-type="0">供应大厅</p>
          <p list-type="1">我的采购</p>
          <p list-type="2">行情大厅</p>
        </div>
        <div class="swiper-container">
          <div class="swiper-wrapper">
            <div class="swiper-slide">
              <div id="minirefresh0" class="minirefresh-wrap">
                <div class="minirefresh-scroll">
                  <ul class="data-list" id="listdata0">
                  </ul>
                </div>
              </div>
            </div>
            <div class="swiper-slide">
              <div id="minirefresh1" class="minirefresh-wrap">
                <div class="minirefresh-scroll">
                  <ul class="data-list" id="listdata1">
                  </ul>
                </div>
              </div>
            </div>
            <div class="swiper-slide">
              <div id="minirefresh2" class="minirefresh-wrap">
                <div class="minirefresh-scroll">
                  <ul class="data-list" id="listdata2">
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>


    </div>

    <div class="weui-tabbar">
      <a href="javascript:;" class="weui-tabbar__item weui-bar__item--on">
        <span class="weui-badge" style="position: absolute;top: -.4em;right: 1em;">8</span>
        <div class="weui-tabbar__icon">
          <img src="./images/icon_nav_button.png" alt="">
        </div>
        <p class="weui-tabbar__label">微信</p>
      </a>
      <a href="javascript:;" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
          <img src="./images/icon_nav_msg.png" alt="">
        </div>
        <p class="weui-tabbar__label">通讯录</p>
      </a>
      <a href="javascript:;" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
          <img src="./images/icon_nav_article.png" alt="">
        </div>
        <p class="weui-tabbar__label">发现</p>
      </a>
      <a href="javascript:;" class="weui-tabbar__item">
        <div class="weui-tabbar__icon">
          <img src="./images/icon_nav_cell.png" alt="">
        </div>
        <p class="weui-tabbar__label">我</p>
      </a>
    </div>
  </div>
</body>
<script>
  var appendTestData = Common.appendTestData,
    bindEvent = Common.bindEvent,
    // 记录一个最新
    maxDataSize = 30,
    listDomArr = [],
    requestDelayTime = 600,
    miniRefreshArr = [],
    currIndex = 0;

  var initMiniRefreshs = function (index) {

    listDomArr[index] = document.querySelector('#listdata' + index);

    miniRefreshArr[index] = new MiniRefresh({
      container: '#minirefresh' + index,
      down: {
        callback: function () {
          setTimeout(function () {
            // 每次下拉刷新后，上拉的状态会被自动重置
            appendTestData(listDomArr[index], 10, true, index);
            miniRefreshArr[index].endDownLoading(true);
          }, requestDelayTime);
        }
      },
      up: {
        isAuto: true,
        callback: function () {
          setTimeout(function () {
            appendTestData(listDomArr[index], 10, false, index);
            miniRefreshArr[index].endUpLoading(listDomArr[index].children.length >= maxDataSize ? true : false);
          }, requestDelayTime);
        }
      }
    });
  };

  var navControl = document.querySelector('.nav-control');

  var mySwiper = new Swiper('.swiper-container', {
    autoplay: 0,
    onSlideChangeEnd: function (swiper) {
      var index = swiper.activeIndex;

      console.log('滑动');
      navControl.querySelector('.active').classList.remove('active');
      navControl.children[index].classList.add('active');
      currIndex = index;
    }
  });

  bindEvent('.nav-control p', function (e) {
    var type = this.getAttribute('list-type');

    type = +type;

    console.log(type + ',' + currIndex);

    if (type !== currIndex) {
      navControl.querySelector('.active').classList.remove('active');
      this.classList.add('active');


      currIndex = type;

      mySwiper.slideTo(currIndex, 500);
    }
  }, 'click');

  initMiniRefreshs(0);
  initMiniRefreshs(1);
  initMiniRefreshs(2);
</script>

</html>